<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      $.get('./common/head.html', function(data) {
        $('head').append(data);
      });
    });
  </script>
</head>


<body>

<!-- header -->
<div id="header"></div>

<section class="home-main-section background-gray">
  <div class="home-hot-content">
    <div class="container">
      <div class="row justify-content-center mb-4">
        <div class="col-auto">
          <div class="btn-group" role="group" aria-label="Category Buttons">
            <a href="/board.html" class="btn btn-outline-primary">전체</a>
            <a href="/board.html?category=1" class="btn btn-outline-primary">도서</a>
            <a href="/board.html?category=2" class="btn btn-outline-primary">의류</a>
            <a href="/board.html?category=3" class="btn btn-outline-primary">전자기기</a>
            <a href="/board.html?category=4" class="btn btn-outline-primary">가구</a>
            <a href="/board.html?category=5" class="btn btn-outline-primary">악세사리</a>
            <a href="/board.html?category=6" class="btn btn-outline-primary">생활용품</a>
            <a href="/board.html?category=9" class="btn btn-outline-primary">기타</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <h1 class="home-main-title home-hot-title">나눔 물품</h1>
  <div id="category"></div>

<!--  나눔 물품 보여주기-->
  <div class="items-wrap">


  </div>
  <!--페이징-->
  <div class="container">
    <div class="row justify-content-center">
      <div id="pagination" class="col-md-6 text-center"></div>
    </div>
  </div>

</section>

<!-- main section -->
<div id="main"></div>


<!-- footer -->
<div id="footer"></div>

<script>
  // URL 매개변수 값 가져오기
  const urlParams = new URLSearchParams(window.location.search);
  const category = urlParams.get('category');
  let currentPage = 0;
  const pageSize = 10;
  let totalPages = 0;

  window.onload = function() {
    loadCategoryPosts(category, 0);
  };

  //카테고리 누를 때 페이지 이동
  function loadCategoryPosts(category, page) {
    fetch(`/api_post/category/${category}?page=${page}&size=${pageSize}`)
            .then(response => response.json())
            .then(data => {
              currentPage = data.currentPage;
              totalPages = data.totalPages;
              renderPosts(data.data);
              renderPagination();
            })
            .catch(error => console.error('Error loading posts:', error));
  }
  function renderPosts(posts) {
    const itemsWrap = document.querySelector('.items-wrap');
    itemsWrap.innerHTML = '';
    posts.forEach(post => {
      const itemElement = document.createElement('article');
      itemElement.classList.add('item');
      itemElement.innerHTML = `
                          <a class="item-link" href="/post/${post.postNo}">
                              <div class="item-photo">
                                  <img src="${post.postFile}" alt="${post.postTitle}">
                              </div>
                              <div class="item-desc">
                                  <h2 class="item-name">${post.postTitle}</h2>
                                  <div class="item-postContent">${post.postContent}</div>
                                  <div class="item-regionName">${post.regionName}</div>
                              </div>
                          </a>
                      `;

      itemsWrap.appendChild(itemElement);
    });
  }
  function renderPagination() {
    const paginationDiv = document.getElementById('pagination');
    paginationDiv.innerHTML = '';

    // 이전 버튼 렌더링
    const prevButton = document.createElement('button');
    prevButton.textContent = 'Previous';
    prevButton.disabled = currentPage === 0;
    prevButton.addEventListener('click', () => {
      loadCategoryPosts(category, currentPage - 1);
      scrollToTop(); // 스크롤 맨 위로 이동
    });
    paginationDiv.appendChild(prevButton);

    // 페이지 버튼 렌더링
    const maxPageButtons = 5;
    const startPage = Math.max(0, currentPage - Math.floor(maxPageButtons / 2));
    const endPage = Math.min(totalPages, startPage + maxPageButtons);

    for (let i = startPage; i < endPage; i++) {
      const pageButton = document.createElement('button');
      pageButton.textContent = i + 1;
      if (i === currentPage) {
        pageButton.classList.add('active'); // 활성화된 페이지를 나타내는 클래스 추가
      }
      pageButton.addEventListener('click', () => {
        loadCategoryPosts(category, i);
        scrollToTop(); // 스크롤 맨 위로 이동
      });
      paginationDiv.appendChild(pageButton);
    }

    // 다음 버튼 렌더링
    const nextButton = document.createElement('button');
    nextButton.textContent = 'Next';
    nextButton.disabled = currentPage === totalPages - 1;
    nextButton.addEventListener('click', () => {
      loadCategoryPosts(category, currentPage + 1);
      scrollToTop(); // 스크롤 맨 위로 이동
    });
    paginationDiv.appendChild(nextButton);
  }
  // 스크롤을 맨 위로 이동하는 함수
  function scrollToTop() {
    window.scrollTo({
      top: 0,
      behavior: 'smooth' // 부드럽게 스크롤
    });
  }

  function setCategoryTitle(category) {
    let title;
    switch(category) {
      case '1':
        title = '도서';
        break;
      case '2':
        title = '의류';
        break;
      case '3':
        title = '전자기기';
        break;
      case '4':
        title = '가구';
        break;
      case '5':
        title = '악세사리';
        break;
      case '6':
        title = '생활용품';
        break;
      case '9':
        title = '기타';
        break;
      default:
        title = '전체';
    }
    $('.home-main-title-top').text('나눔 물품 - ' + title);
  }

  // 페이지 로드시 실행
  setCategoryTitle(category);
</script>
</body>

</html>