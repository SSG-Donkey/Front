<!DOCTYPE html>
<html>
<head>
  <title>Posts</title>
  <style>
    /* 스타일링 */
  </style>
</head>
<body>
<h1>Posts</h1>
<ul id="post-list"></ul>
<div id="pagination"></div>

<script>
  let currentPage = 0;
  const pageSize = 10;
  let totalPages = 0;

  function fetchPosts(page) {
    fetch(`/api_post/getAllPosts?page=${page}&size=${pageSize}`)
            .then(response => response.json())
            .then(data => {
              currentPage = data.currentPage;
              totalPages = data.totalPages;
              renderPosts(data.data);
              renderPagination();
            })
            .catch(error => console.error('Error fetching posts:', error));
  }

  function renderPosts(posts) {
    const postList = document.getElementById('post-list');
    postList.innerHTML = '';
      posts.forEach(post => {
        const itemElement = document.createElement('article');
        itemElement.classList.add('item');
        itemElement.innerHTML = `
                            <a class="item-link" href="/post/${post.postNo}">
                                <div class="item-photo">
                                    <img src="${post.postFile}" alt="${post.postTitle}">
                                </div>
                                <div class="item-desc">
                                    <h2 class="item-name">${post.postTitle}</h2>
                                    <div class="item-postContent">${post.postContent}</div>
                                    <div class="item-region">${post.postCategory}</div>
                                    <div class="item-counts">
                                    </div>
                                </div>
                            </a>
                        `;

      postList.appendChild(itemElement);
    });
  }

  function renderPagination() {
    const paginationDiv = document.getElementById('pagination');
    paginationDiv.innerHTML = '';

    // 이전 버튼 렌더링
    const prevButton = document.createElement('button');
    prevButton.textContent = 'Previous';
    prevButton.disabled = currentPage === 0;
    prevButton.addEventListener('click', () => fetchPosts(currentPage - 1));
    paginationDiv.appendChild(prevButton);

    // 페이지 버튼 렌더링
    const maxPageButtons = 5;
    const startPage = Math.max(0, currentPage - Math.floor(maxPageButtons / 2));
    const endPage = Math.min(totalPages, startPage + maxPageButtons);

    for (let i = startPage; i < endPage; i++) {
      const pageButton = document.createElement('button');
      pageButton.textContent = i + 1;
      if (i === currentPage) {
        pageButton.classList.add('active');
      }
      pageButton.addEventListener('click', () => fetchPosts(i));
      paginationDiv.appendChild(pageButton);
    }

    // 다음 버튼 렌더링
    const nextButton = document.createElement('button');
    nextButton.textContent = 'Next';
    nextButton.disabled = currentPage === totalPages - 1;
    nextButton.addEventListener('click', () => fetchPosts(currentPage + 1));
    paginationDiv.appendChild(nextButton);
  }
  fetchPosts(0);
</script>
</body>
</html>
