<header>
  <div class="header-wrap">
    <div class="logo">
      <a href="index.html">
          <span>
            <svg width="200" height="100" viewBox="0 0 200 56" fill="none" xmlns="http://www.w3.org/2000/svg">
              <image href="https://ssg-donkey-bucket.s3.ap-northeast-2.amazonaws.com/%EB%A1%9C%EA%B3%A0%EC%B5%9C%EC%A2%85.png" width="200" height="100" />
            </svg>
          </span>
      </a>
    </div>
    <div class="category">
      <ul>
        <li><a class="font-orange" href="../index.html">홈으로</a></li>
        <li><a class="font-orange" href="/board.html">나눔 게시판 </a></li>
        <li><a class="font-orange" href="/write.html">나눔 글 작성</a></li>
        <li><a class="font-orange" href="/payment.html">포인트 충전하기</a></li>
        <li><a href="">로그인/회원가입</a></li>

      </ul>
    </div>
    <div class="search-block">
      <input class="search-bar" type="search" placeholder="물품이나 동네를 검색해보세요" />
      <button>검색하기</button>
    </div>
  </div>
</header>

<script>
  $(document).ready(function(){
    // 검색 실행 함수
    function executeSearch() {
      // 검색어 가져오기
      const searchTerm = $('.search-bar').val().trim();
      console.log('검색어:', searchTerm);

      // 검색어가 비어있지 않은 경우에만 검색 페이지로 이동
      if (searchTerm !== '') {
        // 검색 페이지 URL 생성 (검색어를 query parameter로 추가)
        const searchUrl = '/board.html?search=' + encodeURIComponent(searchTerm);
        // 검색 페이지로 이동
        window.location.href = searchUrl;
      }
    }

    // 검색창에서 엔터 키를 눌렀을 때 검색 실행
    $('.search-bar').on('keypress', function(event) {
      if (event.which === 13) { // 엔터 키의 keyCode는 13입니다.
        executeSearch();
      }
    });

    // "검색하기" 버튼을 클릭했을 때 검색 실행
    $('button').on('click', function() {
      executeSearch();
    });

    // 검색 페이지 로드 시 검색어가 있는 경우 API를 호출하여 결과를 가져옴
    if (window.location.pathname === '/board.html' && window.location.search.includes('search=')) {
      const searchTerm = new URLSearchParams(window.location.search).get('search');
      console.log("검색 내용 : " + searchTerm);

      const page = 0; // 페이지 수
      const pageSize = 10; // 페이지당 항목 수

      fetch(`/api_post/search?searchTerm=${encodeURIComponent(searchTerm)}&page=${page}&size=${pageSize}`)
              .then(response => response.json())
              .then(data => {
                // 여기서는 받아온 데이터를 처리하여 결과를 표시합니다.
                console.log('검색 결과:', data);
                currentPage = data.currentPage;
                totalPages = data.totalPages;

                console.log('currentPage:', data.currentPage);
                console.log('totalPages:', data.totalPages);

                renderPosts(data.data);
                renderPagination();
              })
              .catch(error => {
                console.error('검색 API 호출 중 오류 발생:', error);
              });
    }
  });
</script>